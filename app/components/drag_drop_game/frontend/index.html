<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Austin Risk Grid ‚Äî Game</title>

    <!-- MapLibre -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" />

    <!-- Modular CSS (load order matters for variables) -->
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/map.css">
    <link rel="stylesheet" href="./css/story-card.css">
    <link rel="stylesheet" href="./css/units.css">
    <link rel="stylesheet" href="./css/markers.css">
    <link rel="stylesheet" href="./css/buttons.css">
    <link rel="stylesheet" href="./css/loading.css">
    <link rel="stylesheet" href="./css/toast.css">
    <link rel="stylesheet" href="./css/error.css">
    <link rel="stylesheet" href="./css/tutorial.css">
    <link rel="stylesheet" href="./css/metrics-dashboard.css">
    <link rel="stylesheet" href="./css/toggles.css">
    <link rel="stylesheet" href="./css/legend.css">
  </head>

  <body>
    <div id="app">
      <div class="grid">
        <div class="left">
          <div class="card mapCard">
            <div id="map"></div>
            <!-- Loading spinner -->
            <div id="map-skeleton" class="skeleton-map">
              <div class="skeleton-spinner"></div>
            </div>
            <!-- Error overlay -->
            <div id="map-error" class="error-overlay hidden">
              <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              <div class="error-title">Map failed to load</div>
              <div id="map-error-message" class="error-message">
                Unable to load map style. Check your network connection.
              </div>
              <button id="map-retry-btn" class="error-btn error-btn-primary">Retry</button>
            </div>
            <div class="mapTitleWrap">
              <div class="mapTitle">Austin</div>
            </div>
            <div id="overlay" class="mapOverlay"></div>
            <div id="ghost" class="ghost"></div>
          </div>

          <div class="card storyCard">
            <div class="storyHeader">
              <div class="storyTitle" id="storyTitle">
                <span class="emoji" id="storyEmoji">üöë</span>
                <span id="storyTitleText">Mission Briefing</span>
              </div>
              <div class="scenarioDateTime" id="scenarioDateTime">
                <span class="dateTimeIcon">üìÖ</span>
                <span id="scenarioDateTimeText">‚Äî</span>
              </div>
              <div class="headerGrade" id="headerGrade">
                <span id="headerGradeText">‚Äî</span>
              </div>
              <div class="placement-toggle hidden" id="placementToggle">
                <button class="toggle-btn toggle-btn-human active" id="toggleHuman" aria-pressed="true">
                  <span class="toggle-icon">üë§</span>
                  <span>Human</span>
                </button>
                <button class="toggle-btn toggle-btn-ai" id="toggleAI" aria-pressed="false">
                  <span class="toggle-icon">ü§ñ</span>
                  <span>AI</span>
                </button>
              </div>
            </div>

            <div class="storyBody" id="storyBody">
              <div class="storyContent">
                <div class="storyCopy" id="storyCopy">
                  Position your four ambulances to maximize coverage of high-risk zones. Red areas indicate higher predicted incident probability for the next hour.
                </div>
                <div class="storyHints" id="storyHints">
                  <div class="storyHint">
                    <span class="hintIcon">üí°</span>
                    <span>Downtown and entertainment districts typically see higher call volumes.</span>
                  </div>
                </div>
              </div>
              <div class="incidentStat">
                <div class="incidentLabel">Historical Incidents</div>
                <div class="incidentValue" id="mIncidents">‚Äî</div>
              </div>
            </div>
            
            <div class="scoringPanel" id="scoringPanel">
              <div class="scoringMetrics">
                <div class="scoringMetric">
                  <div class="label">Your Score</div>
                  <div class="value" id="playerScore">‚Äî</div>
                </div>
                <div class="scoringMetric">
                  <div class="label">AI Score</div>
                  <div class="value" id="aiScore">‚Äî</div>
                </div>
                <div class="scoringMetric">
                  <div class="label">Coverage</div>
                  <div class="value" id="coverageScore">‚Äî</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="right">
          <div class="card panelCard">
            <div class="label">Scenario</div>
            <div class="selectWrap">
              <select id="scenarioSelect" class="select">
                <option value="default">Normal Operations</option>
                <option value="sxsw">SXSW 2025</option>
                <option value="acl">ACL Festival</option>
                <option value="f1">F1 US Grand Prix</option>
                <option value="july4">Fourth of July</option>
                <option value="halloween">Halloween Weekend</option>
                <option value="nye">New Year's Eve</option>
                <option value="ut_game">UT Football Game</option>
              </select>
            </div>

            <div style="height: 10px"></div>
            <div class="label">Weather Conditions</div>
            <div class="selectWrap">
              <select id="weatherSelect" class="select">
                <option value="clear">‚òÄÔ∏è Clear</option>
                <option value="cloudy">‚òÅÔ∏è Cloudy</option>
                <option value="light_rain">üåßÔ∏è Light Rain</option>
                <option value="heavy_rain">‚õàÔ∏è Heavy Rain</option>
                <option value="thunderstorm">üå©Ô∏è Thunderstorm</option>
                <option value="fog">üå´Ô∏è Fog</option>
                <option value="ice">üßä Ice / Freezing</option>
                <option value="snow">‚ùÑÔ∏è Snow</option>
              </select>
            </div>

            <div style="height: 10px"></div>
            <div class="label">Ambulances</div>
            <div class="selectWrap">
              <select id="ambulanceCount" class="select">
                <option value="2">2 units</option>
                <option value="3">3 units</option>
                <option value="4" selected>4 units</option>
                <option value="5">5 units</option>
                <option value="6">6 units</option>
              </select>
            </div>

            <div style="height: 14px"></div>
            <div class="risk-legend">
              <div class="label">Risk Level</div>
              <div class="legend-bar">
                <div class="legend-gradient"></div>
                <div class="legend-labels">
                  <span>Low</span>
                  <span>High</span>
                </div>
              </div>
            </div>

            <div style="height: 14px"></div>
            <div class="toggle-section">
              <div class="label">Appearance</div>
              <div class="toggle-row">
                <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">
                  <span class="theme-icon theme-icon-light">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="5"/>
                      <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                  </span>
                  <span class="theme-icon theme-icon-dark">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                  </span>
                  <span class="toggle-track">
                    <span class="toggle-thumb"></span>
                  </span>
                </button>
                <span class="toggle-label" id="themeLabel">Light</span>
              </div>
            </div>

            <div style="height: 12px"></div>
            <div class="label">Your placements (drag onto map)</div>
            <div id="bay" class="bay"></div>
          </div>

          <div>
            <button id="deploy" class="btn" disabled>Compare with AI</button>
            <button id="reset" class="btn btnSecondary">Reset</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast notification container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Floating Metrics Dashboard Panel -->
    <div id="metrics-dashboard" class="metrics-dashboard">
      <div class="metrics-header" id="metrics-header">
        <div class="metrics-title">
          <span class="metrics-icon">üìä</span>
          <span>Live Performance</span>
        </div>
        <button class="metrics-toggle-btn" id="metrics-collapse" aria-label="Collapse panel">
          <span class="collapse-icon">‚àí</span>
        </button>
      </div>

      <div class="metrics-body" id="metrics-body">
        <div class="metrics-gauge-section">
          <div class="gauge-container">
            <svg class="gauge-svg" viewBox="0 0 120 70">
              <path class="gauge-bg" d="M10 60 A50 50 0 0 1 110 60" />
              <path class="gauge-fill" id="gauge-fill" d="M10 60 A50 50 0 0 1 110 60" />
              <text class="gauge-label" x="18" y="55">AI</text>
              <text class="gauge-label" x="95" y="55">You</text>
            </svg>
            <div class="gauge-score" id="gauge-score">--</div>
            <div class="gauge-comparison" id="gauge-comparison">vs AI: --</div>
          </div>
        </div>

        <div class="metrics-kpi-grid">
          <div class="kpi-card" data-metric="coverage">
            <div class="kpi-header">
              <span class="kpi-label">Coverage</span>
              <span class="kpi-trend" id="trend-coverage"></span>
            </div>
            <div class="kpi-value" id="kpi-coverage">--</div>
            <div class="kpi-sparkline" id="sparkline-coverage"></div>
          </div>

          <div class="kpi-card" data-metric="incidents">
            <div class="kpi-header">
              <span class="kpi-label">Incidents</span>
              <span class="kpi-trend" id="trend-incidents"></span>
            </div>
            <div class="kpi-value" id="kpi-incidents">--</div>
            <div class="kpi-sparkline" id="sparkline-incidents"></div>
          </div>

          <div class="kpi-card" data-metric="efficiency">
            <div class="kpi-header">
              <span class="kpi-label">Score</span>
              <span class="kpi-trend" id="trend-efficiency"></span>
            </div>
            <div class="kpi-value" id="kpi-efficiency">--</div>
            <div class="kpi-sparkline" id="sparkline-efficiency"></div>
          </div>
        </div>

        <div class="metrics-context">
          <span class="context-label">Evaluation Window:</span>
          <span class="context-value" id="eval-window">-- days</span>
        </div>
      </div>
    </div>

    <!-- Tutorial overlay -->
    <div id="tutorial-overlay" class="tutorial-overlay hidden">
      <div class="tutorial-backdrop"></div>
      <div class="tutorial-spotlight"></div>
      <div class="tutorial-tooltip" data-position="right">
        <div class="tutorial-header">
          <span class="tutorial-step-indicator">1 / 4</span>
          <button class="tutorial-close" aria-label="Close tutorial">&times;</button>
        </div>
        <h3 class="tutorial-title">Welcome</h3>
        <p class="tutorial-content">Loading tutorial...</p>
        <div class="tutorial-demo-warning hidden">
          <span class="demo-icon">‚ö†Ô∏è</span>
          <span>Demo Mode: Data shown is simulated for demonstration purposes.</span>
        </div>
        <div class="tutorial-footer">
          <button class="tutorial-skip">Skip Tutorial</button>
          <div class="tutorial-nav">
            <button class="tutorial-prev" disabled>Back</button>
            <button class="tutorial-next">Next</button>
          </div>
        </div>
        <div class="tutorial-progress">
          <div class="tutorial-progress-bar"></div>
        </div>
      </div>
    </div>

    <!-- External libs (runtime CDN). This avoids a frontend build pipeline. -->
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/deck.gl@8.9.36/dist.min.js"></script>

    <!-- ES6 Module entry point -->
    <script type="module" src="./main.js"></script>
  </body>
</html>


